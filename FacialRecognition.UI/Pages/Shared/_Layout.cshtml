@using FacialRecognition.Data.Models
@using Microsoft.AspNetCore.Identity
@inject SignInManager<AppUser> SignInManager
@inject UserManager<AppUser> UserManager
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <!-- Favicon icon -->
    @*<link rel="shortcut icon" href="~/assets/images/favicon.png" type="image/x-icon">
        <link rel="icon" href="~/assets/images/favicon.ico" type="image/x-icon">*@

    <!-- Google font-->
    <link href="https://fonts.googleapis.com/css?family=Ubuntu:400,500,700" rel="stylesheet">

    <!-- themify -->
    <link rel="stylesheet" type="text/css" href="~/assets/icon/themify-icons/themify-icons.css">

    <!-- iconfont -->
    <link rel="stylesheet" type="text/css" href="~/assets/icon/icofont/css/icofont.css">

    <!-- simple line icon -->
    <link rel="stylesheet" type="text/css" href="~/assets/icon/simple-line-icons/css/simple-line-icons.css">

    <!-- Required Fremwork -->
    <link rel="stylesheet" type="text/css" href="~/assets/plugins/bootstrap/css/bootstrap.min.css">



    <!-- Style.css -->
    <link rel="stylesheet" type="text/css" href="~/assets/css/main.css">

    <!-- Responsive.css-->
    <link rel="stylesheet" type="text/css" href="~/assets/css/responsive.css">
    <link href="~/css/select2/css/select2.min.css" rel="stylesheet" />
    <link href="~/lib/datatables.net-bs5/dataTables.bootstrap5.min.css" rel="stylesheet" />
</head>
<body class="sidebar-mini fixed">
    <div class="loader-bg">
        <div class="loader-bar">
        </div>
    </div>
    <div class="wrapper">

        <header class="main-header-top hidden-print">
            <a href="#" class="logo">
                <img class="img-fluid able-logo" src="~/img/logoipsum-logo-29.svg">
            </a>
            <nav class="navbar navbar-static-top">
                <!-- Sidebar toggle button-->
                <a href="#!" data-toggle="offcanvas" class="sidebar-toggle"></a>
                <!-- Navbar Right Menu-->
                <div class="navbar-custom-menu f-right m-t-15">

                    <ul class="top-nav">
                        <partial name="_LoginPartial" />
                    </ul>

                </div>
            </nav>
        </header>
        <aside class="main-sidebar hidden-print ">
            <section class="sidebar" id="sidebar-scroll">
                <!-- Sidebar Menu-->
                <ul class="sidebar-menu">
                    <li class="nav-level">--- Dashboard</li>
                    <li class="active treeview">
                        <a class="waves-effect waves-dark" asp-page="/Index">
                            <i class="icon-book-open"></i><span> Courses</span>
                        </a>
                    </li>

                    @if (SignInManager.IsSignedIn(User))
                    {
                        @if (User.IsInRole("Lecturer"))
                        {
                            <li class="nav-level">--- Student Validation</li>
                            <li class="treeview">
                                <a class="waves-effect waves-dark" asp-page="/ValidateStudent">
                                    <i class="icofont icofont-finger-print"></i><span> Authenticate Students</span>
                                </a>
                            </li>
                        }
                    }
                    @*<li class="nav-level">--- Components</li>
                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="#!"><i class="icon-briefcase"></i><span> UI Elements</span><i class="icon-arrow-down"></i></a>
                        <ul class="treeview-menu">
                            <li><a class="waves-effect waves-dark" href="accordion.html"><i class="icon-arrow-right"></i> Accordion</a></li>
                            <li><a class="waves-effect waves-dark" href="button.html"><i class="icon-arrow-right"></i> Button</a></li>
                            <li><a class="waves-effect waves-dark" href="label-badge.html"><i class="icon-arrow-right"></i> Label Badge</a></li>
                            <li><a class="waves-effect waves-dark" href="bootstrap-ui.html"><i class="icon-arrow-right"></i> Grid system</a></li>
                            <li><a class="waves-effect waves-dark" href="box-shadow.html"><i class="icon-arrow-right"></i> Box Shadow</a></li>
                            <li><a class="waves-effect waves-dark" href="color.html"><i class="icon-arrow-right"></i> Color</a></li>
                            <li><a class="waves-effect waves-dark" href="light-box.html"><i class="icon-arrow-right"></i> Light Box</a></li>
                            <li><a class="waves-effect waves-dark" href="notification.html"><i class="icon-arrow-right"></i> Notification</a></li>
                            <li><a class="waves-effect waves-dark" href="panels-wells.html"><i class="icon-arrow-right"></i> Panels-Wells</a></li>
                            <li><a class="waves-effect waves-dark" href="tabs.html"><i class="icon-arrow-right"></i> Tabs</a></li>
                            <li><a class="waves-effect waves-dark" href="tooltips.html"><i class="icon-arrow-right"></i> Tooltips</a></li>
                            <li><a class="waves-effect waves-dark" href="typography.html"><i class="icon-arrow-right"></i> Typography</a></li>
                        </ul>
                    </li>

                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="#!"><i class="icon-chart"></i><span> Charts &amp; Maps</span><span class="label label-success menu-caption">New</span><i class="icon-arrow-down"></i></a>
                        <ul class="treeview-menu">
                            <li><a class="waves-effect waves-dark" href="float-chart.html"><i class="icon-arrow-right"></i> Float Charts</a></li>
                            <li><a class="waves-effect waves-dark" href="morris-chart.html"><i class="icon-arrow-right"></i> Morris Charts</a></li>
                        </ul>
                    </li>

                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="#!"><i class="icon-book-open"></i><span> Forms</span><i class="icon-arrow-down"></i></a>
                        <ul class="treeview-menu">
                            <li><a class="waves-effect waves-dark" href="form-elements-bootstrap.html"><i class="icon-arrow-right"></i> Form Elements Bootstrap</a></li>

                            <li><a class="waves-effect waves-dark" href="form-elements-advance.html"><i class="icon-arrow-right"></i> Form Elements Advance</a></li>
                        </ul>
                    </li>

                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="basic-table.html">
                            <i class="icon-list"></i><span> Table</span>
                        </a>
                    </li>


                    <li class="nav-level">--- More</li>

                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="#!"><i class="icon-docs"></i><span>Pages</span><i class="icon-arrow-down"></i></a>
                        <ul class="treeview-menu">
                            <li class="treeview">
                                <a href="#!"><i class="icon-arrow-right"></i><span> Authentication</span><i class="icon-arrow-down"></i></a>
                                <ul class="treeview-menu">
                                    <li><a class="waves-effect waves-dark" href="register1.html" target="_blank"><i class="icon-arrow-right"></i> Register 1</a></li>

                                    <li><a class="waves-effect waves-dark" href="login1.html" target="_blank"><i class="icon-arrow-right"></i><span> Login 1</span></a></li>
                                    <li><a class="waves-effect waves-dark" href="forgot-password.html" target="_blank"><i class="icon-arrow-right"></i><span> Forgot Password</span></a></li>

                                </ul>
                            </li>

                            <li><a class="waves-effect waves-dark" href="404.html" target="_blank"><i class="icon-arrow-right"></i> Error 404</a></li>
                            <li><a class="waves-effect waves-dark" href="sample-page.html"><i class="icon-arrow-right"></i> Sample Page</a></li>

                        </ul>
                    </li>


                    <li class="nav-level">--- Menu Level</li>

                    <li class="treeview">
                        <a class="waves-effect waves-dark" href="#!"><i class="icofont icofont-company"></i><span>Menu Level 1</span><i class="icon-arrow-down"></i></a>
                        <ul class="treeview-menu">
                            <li>
                                <a class="waves-effect waves-dark" href="#!">
                                    <i class="icon-arrow-right"></i>
                                    Level Two
                                </a>
                            </li>
                            <li class="treeview">
                                <a class="waves-effect waves-dark" href="#!">
                                    <i class="icon-arrow-right"></i>
                                    <span>Level Two</span>
                                    <i class="icon-arrow-down"></i>
                                </a>
                                <ul class="treeview-menu">
                                    <li>
                                        <a class="waves-effect waves-dark" href="#!">
                                            <i class="icon-arrow-right"></i>
                                            Level Three
                                        </a>
                                    </li>
                                    <li>
                                        <a class="waves-effect waves-dark" href="#!">
                                            <i class="icon-arrow-right"></i>
                                            <span>Level Three</span>
                                            <i class="icon-arrow-down"></i>
                                        </a>
                                        <ul class="treeview-menu">
                                            <li>
                                                <a class="waves-effect waves-dark" href="#!">
                                                    <i class="icon-arrow-right"></i>
                                                    Level Four
                                                </a>
                                            </li>
                                            <li>
                                                <a class="waves-effect waves-dark" href="#!">
                                                    <i class="icon-arrow-right"></i>
                                                    Level Four
                                                </a>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>*@
                </ul>
            </section>
        </aside>
        <div class="content-wrapper">
            @RenderBody()
        </div>

        <script src="~/js/site.js" asp-append-version="true"></script>
        <script src="~/assets/plugins/Jquery/dist/jquery.min.js"></script>
        <script src="~/assets/plugins/jquery-ui/jquery-ui.min.js"></script>
        <script src="~/assets/plugins/tether/dist/js/tether.min.js"></script>

        <!-- Required Fremwork -->
        <script src="~/assets/plugins/bootstrap/js/bootstrap.min.js"></script>

        <!-- Scrollbar JS-->
        <script src="~/assets/plugins/jquery-slimscroll/jquery.slimscroll.js"></script>
        <script src="~/assets/plugins/jquery.nicescroll/jquery.nicescroll.min.js"></script>
        <!--classic JS-->
        <script src="~/assets/plugins/classie/classie.js"></script>

        <!-- notification -->
        <script src="~/assets/plugins/notification/js/bootstrap-growl.min.js"></script>

        <!-- Sparkline charts -->
        <script src="~/assets/plugins/jquery-sparkline/dist/jquery.sparkline.js"></script>

        <!-- Counter js  -->
        <script src="~/assets/plugins/waypoints/jquery.waypoints.min.js"></script>
        <script src="~/assets/plugins/countdown/js/jquery.counterup.js"></script>

        <!-- Echart js -->
        <script src="~/assets/plugins/charts/echarts/js/echarts-all.js"></script>

        <!-- custom js -->
        <script type="text/javascript" src="~/assets/js/main.min.js"></script>
        <script type="text/javascript" src="~/assets/pages/dashboard.js"></script>
        <script type="text/javascript" src="~/assets/pages/elements.js"></script>
        <script src="~/assets/js/menu.min.js"></script>
        <script src="~/css/select2/js/select2.min.js"></script>
        <script src="~/lib/datatables.net/jquery.dataTables.min.js"></script>
        <script src="~/lib/datatables.net-bs5/dataTables.bootstrap5.min.js"></script>
        <script src="~/webcamjs-master/webcam.js"></script>
        <script>
            var table;
            var $window = $(window);
            var nav = $('.fixed-button');
            var rowData;
            $window.scroll(function () {
                if ($window.scrollTop() >= 200) {
                    nav.addClass('active');
                }
                else {
                    nav.removeClass('active');
                }
            });
            $(document).ready(function () {
                $('#recognitionResult').hide();
                table = $('#example').DataTable({
                    "bLengthChange": false,
                    "language": {
                        "emptyTable": "Please select a course"
                    },
                    "columnDefs": [{
                        "targets": 0,
                        "visible": false,
                        "searchable": false
                    }],
                    "columnDefs": [{
                        "targets": 5,
                        "data": null,
                        "defaultContent": `<button id="getRowData" class="btn btn-primary btn-sm rounded-0" data-toggle="modal" data-target="#authModal" type="button" ><i class="icofont icofont-finger-print"></i> Authenticate </button>`
                    }],
                    "columns": [
                        { "data": "$id" },
                        { "data": "regNo" },
                        { "data": "firstName" },
                        { "data": "lastName" },
                        { "data": "department" },
                    ],
                });
                $('.js-example-basic').select2({
                    placeholder: 'Select a Course'
                }).on("change", function () {
                    var courseCode = $(this).val();
                    $.getJSON(`?handler=GetCourseStudents&courseCode=${courseCode}`).done(function (result) {
                        //result = JSON.parse(result);
                        table.clear();
                        table.rows.add(result).draw();
                    });;
                });
                $(".js-example-tags").select2({
                    dropdownParent: $('#exampleModalCenter'),
                    tags: true,
                    placeholder: "Select a Course",
                    width: "570px"
                }).on('change', function () {
                    var $selected = $(this).find('option:selected');
                    var $container = $(this).siblings('.js-example-tags-container');

                    var $list = $('<ul>');
                    $selected.each(function (k, v) {
                        var $li = $('<li class="tag-selected"><a class="destroy-tag-selected">×</a>' + $(v).text() + '</li>');
                        $li.children('a.destroy-tag-selected')
                            .off('click.select2-copy')
                            .on('click.select2-copy', function (e) {
                                var $opt = $(this).data('select2-opt');

                                $opt.prop('selected', false); // <-- Main difference

                                $opt.parents('select').trigger('change');
                            }).data('select2-opt', $(v));
                        $list.append($li);
                    });
                    $container.html('').append($list);
                }).trigger('change');

                $("#authModal").on('shown.bs.modal', function (event) {
                    var button = event.relatedTarget
                    rowData = table.row($(button).parents('tr')).data();
                })
                $("#takeSnapshot").click(function () {

                    var formData = new FormData();
                    var postData;
                    // take snapshot and get image data
                    Webcam.snap(function (data_uri) {
                        // display results in page
                        document.getElementById('results').innerHTML =
                            '<img id = "studentImage" src="' +
                            data_uri +
                            '"/>';
                        var base64 = getBase64Image(data_uri);
                        console.log(base64)
                        postData = {
                            'picture': base64,
                            'studentId': rowData.regNo
                        };
                        console.log("Postdata:" + postData);
                    });

                    $.ajax({
                        type: "POST",
                        headers: { "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val() },
                        url: '/ValidateStudent?handler=UploadImage',
                        data: postData,
                        dataType: "json"
                    }).done(function (data) {
                        console.log(data);
                        document.getElementById('recognitionResult').innerHTML = data + `<button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span >
                                    </button >`;
                        $('#recognitionResult').show();
;                    });
                })
            });
            $(function () {
                $('.sidebar-menu li a').filter(function () { return this.href == location.href }).parent().addClass('active').siblings().removeClass('active')
                $('.sidebar-menu li a').click(function () {
                    $(this).parent().addClass('active').siblings().removeClass('active')
                })
            });
            function getBase64Image(img) {
                var dataURL = img;
                return dataURL.replace(/^data:image\/(png|jpeg);base64,/, "");
            }
            //function dataURItoBlob(dataURI) {
            //    // convert base64/URLEncoded data component to raw binary data held in a string
            //    var byteString;
            //    if (dataURI.split(',')[0].indexOf('base64') >= 0)
            //        byteString = atob(dataURI.split(',')[1]);
            //    else
            //        byteString = unescape(dataURI.split(',')[1]);

            //    // separate out the mime component
            //    var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];

            //    // write the bytes of the string to a typed array
            //    var ia = new Uint8Array(byteString.length);
            //    for (var i = 0; i < byteString.length; i++) {
            //        ia[i] = byteString.charCodeAt(i);
            //    }

            //    return new Blob([ia], { type: mimeString });
            //}
        </script>
        @await RenderSectionAsync("Scripts", required: false)
    </div>
    <!--<nav class="navbar navbar-expand-lg py-2 navbar-dark bg-dark shadow-sm">
        <div class="container">
            <a href="#" class="navbar-brand">-->
    <!-- Logo Image -->
    <!--<img src="https://res.cloudinary.com/mhmd/image/upload/v1557368579/logo_iqjuay.png" width="45" alt="" class="d-inline-block align-middle mr-2">-->
    <!-- Logo Text -->
    <!--<span class="text-uppercase font-weight-bold">Company</span>
            </a>

            <button type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"><span class="navbar-toggler-icon"></span></button>

            <div id="navbarSupportedContent" class="collapse navbar-collapse">
                <ul class="navbar-nav ml-auto">
                    <partial name="_LoginPartial" />
                </ul>
            </div>
        </div>
    </nav>-->
    <!--<nav class="navbar navbar-expand-lg navbar-light py-3">
        <div class="container">-->
    <!-- Navbar Brand -->
    <!--<a href="#" class="navbar-brand">
                <img src="https://res.cloudinary.com/mhmd/image/upload/v1571398888/Group_1514_tjekh3_zkts1c.svg" alt="logo" width="150">
            </a>
        </div>
    </nav>-->
</body>
</html>
